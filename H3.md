# H3 Demoni

## Käyttöympäristö

MacBookPro 13-tuumainen 2020 <br />
MacOS Sequoia Versio 15.0.1 <br />
Prosessori: 1,4 GHz Neliytiminen Intel Core i5 <br />
Näytönohjain: Intel Iris Plus Graphics 645, 1536 Mt <br />
Muisti: 8 Gt 2133 MHz LPDDR3 <br />

Oracle VirtualBox Version 7.1.4 r165100 (Qt6.5.3) <br />
Debian GNU/Linux 12 Bookworm (64-bit) <br />
4000 MB RAM <br />
60 GB Levytilaa <br />

# x) Lue ja tiivistä 

## Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port
Aloitin tehtävän 16.11.2024 klo 14.30 ja lopetin klo 18.45.

Saltia voidaan käyttää monien demonien hallintaan. Karvinen (2018) esittelee artikkelissaan Saltin avulla toteutetun tilan, jolla voi muuttaa SSH-palvelimen porttia. Ensin asennetaan ohjelmisto (pkg), seuraavaksi korvataan asetustiedosto (file) ja sitten käynnistetään palvelu uudelleen, jotta uudet asetukset tulevat voimaan (service). 


## $ sudo salt-call --local sys.state_doc pkg # johdanto + silmäile pkg.installed, pkg.purged, pkgs

Annoin komennon (ja tämän jälkeen salasanan):

    % sudo salt-call --local sys.state_doc pkg

### Pääpiirteet salt dokumantaation package- osiosta: 

- Salt käyttää pkg-moduulia hallinnoidakseen ohjelmistopaketteja.
- Pakettienhallintatoimintoja ovat asennus (pkg.installed), päivitys, poisto (pkg.purged), ja ryhmäasennukset.
- Salt osaa käyttää alustan natiivia pakettienhallintaa, kuten yum, apt, tai zypper.
- Uudempien systemd-versioiden kanssa käytetään systemd-run-komentoa. 


## $ sudo salt-call --local sys.state_doc file # johdanto + silmäile file.managed, file.absent, file.symlink

Annoin komennon (ja tämän jälkeen salasanan):

    % sudo salt-call --local sys.state_doc file

### Pääpiirteet salt dokumantaation file- osiosta: 

Saltin file -tilafunktiot tarjoavat monia tapoja hallita tiedostoja ja hakemistoja järjestelmässä. 

- file.managed -tilafunktio hallinnoi tiedostoja järjestelmässä ja lataa tiedostoja Salt-masterilta ja asentaa ne haluttuun paikkaa kohdejärjestelmässä. 
- file.absent -tilafunktio varmistaa, että määritelty tiedosto tai hakemisto poistetaan. 
- file.symlink -tilafunktio luo symbolisen linkin joka korvaa olemassa olevan linkin, jos se ei osoita määritettyyn kohteeseen. 


## $ sudo salt-call --local sys.state_doc service # johdanto + silmäile service.running, service.dead, enable

Annoin komennon (ja tämän jälkeen salasanan):

    % sudo salt-call --local sys.state_doc service

### Pääpiirteet salt dokumantaation service- osiosta: 

Saltin service-tila hallitsee palveluiden tilaa järjestelmässä. Se voi käynnistää, pysäyttää, mahdollistaa tai estää palveluja eri alustoilla ja init-järjestelmissä.

-	service.running varmistaa, että palvelu on käynnissä. Voit määrittää, käynnistetäänkö palvelu käynnistyksessä (enable: True), ja onko mahdollista määrittää odotusaikaa, ennen kuin palvelun katsotaan olevan valmis käytettäväksi.
-	service.dead pysäyttää palvelun, jos se on käynnissä. Tätä käytetään palvelun sammuttamiseen esimerkiksi päivityksen tai ylläpidon yhteydessä.
-	enable asettaa palvelun käynnistymään automaattisesti järjestelmän käynnistyessä. Voit asettaa sen True (jolloin se käynnistetään) tai False (jolloin se ei käynnisty).

Lähde: Salt manual 2024.

## Pieni korjaus edellisen kotitehtävään. Olin unohtanut muuttaa vm asennuksen bullseyen -> bookwormiksi, joten teen ensin updaten siihen. Toivon etten riko mitään. Tarkoituksena olisi kokeilla päivitystä niin, ettei saltin asennusta tarvitsisi tehdä uudelleen. 

    % nano vagrantfile

tänne vaihdoin vm:n bullseye -> bookworm64 (Gite 2024).


<img width="569" alt="Näyttökuva 2024-11-17 kello 18 32 44" src="https://github.com/user-attachments/assets/d67f6013-9a4d-489d-98b8-3bb93af3baef">

Seuraavaksi annoin komennon 

    $ sudo nano /etc/apt/sources.list

ja vaihdoin tänne kaikki bullseyet -> bookwormiksi (You tube 2023).  

Alkutilanne:
<img width="569" alt="Näyttökuva 2024-11-17 kello 18 49 46" src="https://github.com/user-attachments/assets/0641d1dd-af7e-41b5-b653-89f49ca96ec3">

Lopputilanne:
<img width="569" alt="Näyttökuva 2024-11-17 kello 18 51 07" src="https://github.com/user-attachments/assets/7f5831d5-698a-4c01-8a32-8f723a917e07">

Sitten annoin YouTube (2023) ohjetta mukaillen komennot: 

    $ sudo apt clean
    $ sudo apt update

<img width="581" alt="Näyttökuva 2024-11-17 kello 18 56 32" src="https://github.com/user-attachments/assets/d8375dd5-93ce-4bfb-af05-f24ffd4b5cf0">

Sitten annoin YouTube (2023) ohjetta mukaillen vielä komennon: 

    $ sudo apt upgrade

<img width="581" alt="Näyttökuva 2024-11-17 kello 18 59 13" src="https://github.com/user-attachments/assets/bdac166f-811d-4044-81d2-708a046eae56">

Valitsin "YES" ja jatkoin. 


Sitten annoin YouTube (2023) ohjetta mukaillen vielä komennon: 

    $ sudo apt autoremove

jolloin sain errorin ja viestin, että korjatakseni tämän, tulisi ajaa komento:

    $ sudo dpkg --configure -a

<img width="690" alt="Näyttökuva 2024-11-17 kello 19 24 45" src="https://github.com/user-attachments/assets/f7eed915-f576-4ed4-b069-93510182bcd2">

Saan ilmoituksen (jonka ottamani kuvankaappaus mystisesti hävisi), jossa valitsen ensimmäisen vaihtoehdon, koska haluan uusimman version. Ensimmäinen vaihtoehto oli suunnilleen "do you want to install package mantainer´s version?" muut luokkaa "haluan pitää kaikki". 

Sitten annoin jälleen YouTube (2023) ohjetta mukaillen komennot: 

    $ sudo apt update
    $ sudo apt upgrade

Lensin ulos (loppuiko tila???), joten tsekkaan statuksen

    $ vagrant status

kaikki virtuaalikoneet pystyssä, joten takas sisälle. 

    $ vagrant ssh t001

Ajoin uudelleen (jotta saisin vapautettua tilaa, jos siitä kyse)

    $ sudo apt autoremove 
    $ sudo apt clean

Sitten ajoin jälleen YouTube (2023) ohjetta mukaillen komennot

    $ sudo apt update
    $ sudo apt upgrade
    $ sudo apt full-upgrade
    $ sudo reboot

Sitten haluan tarkistaa, onko bookworm päivittynyt, antamalla komennon (Gite 2024)

    $ lsb_release -a

Ja onhan se. Wohoo!! Tämä tuskin oli nopein tapa, mutta onnistui!

<img width="338" alt="Näyttökuva 2024-11-17 kello 19 53 40" src="https://github.com/user-attachments/assets/06b61e94-2969-4374-9047-26796608cf7a">

Kauhukseni muistin, että koko sama hela hoito pitää tehdä myös t002 koneelle, joten teen sen nyt. Raportoin siitä ainoastaan jos tulee ongelmia. 

Alla kuva t002 alkutilanteesta: 

<img width="338" alt="Näyttökuva 2024-11-17 kello 19 56 53" src="https://github.com/user-attachments/assets/49928392-dbdf-474b-bb8e-68d202a25c42">

Ja tässä lopputilanne! Wohoo!

<img width="338" alt="Näyttökuva 2024-11-17 kello 20 42 55" src="https://github.com/user-attachments/assets/0b4d3f8c-4673-46dc-9236-ec2f8b737be4">


# a) Apache easy mode. Asenna Apache, korvaa sen testisivu ja varmista, että demoni käynnistyy.
Ensin käsin, vasta sitten automaattisesti.
Kirjoita tila sls-tiedostoon.
pkg-file-service
Tässä ei tarvita service:ssä watch, koska index.html ei ole asetustiedosto


# b) SSHouto. Lisää uusi portti, jossa SSHd kuuntelee.
Jos käytät Vagrantia, muista jättää portti 22/tcp auki - se on oma yhteytesi koneeseen. SSHd:n asetustiedostoon voi tehdä yksinkertaisesti kaksi "Port" riviä, molemmat portit avataan.
Löydät oikean asetuksen katsomalla SSH:n asetustiedostoa
Nyt tarvitaan service-watch, jotta demoni käynnistetään uudelleen, jos asetustiedosto muuttuu masterilla
# c) Oma moduli. Valitse aihe omalle modulille. Varaa se myös kommentilla tämän kurssisivun perään. Kuvaile aihetta niin, että se yksilöi, mitä aiot tehdä. Aihesiin voi toki tulla muutoksia, kun rakennellessa oppii lisää ja paljastuu uusia yllätyksiä. (Tämä kohta ei edellytä testejä tietokoneella. Suosittelen omaa nimeä, mutta jos uskalla tai muuten halua, voit käyttää varauskommentissa etunimeä tai samaa nimimerkkiä, jota käytät läksyissä. ps. Käytä luovuutta, yleisönä ovat omat luokkakaverit. Voit vaikka viritellä jotain, mitä teet muutenkin. On nähty pelipalvelimia, Windows-työpöytiä, taiteilijan työasemaa, harjoitusmaaleja ja vaikka mitä.)
# d) VirtualHost. Asenna Apache tarjoilemaan weppisivua. Weppisivun tulee näkyä palvelimen etusivulla (localhost). HTML:n tulee olla jonkun käyttäjän kotihakemistossa, ja olla muokattavissa normaalin käyttäjän oikeuksin, ilman sudoa.
# e) Vapaaehtoinen, hieman haastava: Caddy. Asenna Caddy tarjoilemaan weppisivua. Weppisivun tulee näkyä palvelimen etusivulla (localhost). HTML:n tulee olla jonkun käyttäjän kotihakemistossa, ja olla muokattavissa normaalin käyttäjän oikeuksin, ilman sudoa.
# f) Vapaaehtoinen, hieman haastava: Nginx. Asenna Nginx (lausutaan engine-X) tarjoilemaan weppisivua. Weppisivun tulee näkyä palvelimen etusivulla (localhost). HTML:n tulee olla jonkun käyttäjän kotihakemistossa, ja olla muokattavissa normaalin käyttäjän oikeuksin, ilman sudoa.
# g) Vapaaehtoinen, haastava: PostgreSQL. Asenna PostgreSQL-tietokannanhallintajärjestelmä. Anna jollekin käyttäjälle oma tietokanta. Osoita testillä, että se toimii.

# Lähteet

- Karvinen, T. 2018. Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port. Luettavissa: https://terokarvinen.com/2018/04/03/pkg-file-service-control-daemons-with-salt-change-ssh-server-port/. Luettu: 16.11.2024.
- Salt manual 2024. Oman koneen terminaali. Luettu: 16.11.2024.
- Gite, V. 2024. Luettavissa: https://www.cyberciti.biz/faq/update-upgrade-debian-11-to-debian-12-bookworm/. Luettu 17.11.2024
- YouTube video 2023. Updating from Bullseye to Bookworm - Debian 12. Katsottavissa: https://www.youtube.com/watch?app=desktop&v=BYTKhS1l-Jc. Katsottu: 17.11.2024. 
