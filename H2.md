# H2 Infra-as-code

Aloitin työn xx.xx.2024 klo xx ja lopetin klo xx.xx.

### Käyttöympäristö

MacBookPro 13-tuumainen 2020 <br />
MacOS Sequoia Versio 15.0.1 <br />
Prosessori: 1,4 GHz Neliytiminen Intel Core i5 <br />
Näytönohjain: Intel Iris Plus Graphics 645, 1536 Mt <br />
Muisti: 8 Gt 2133 MHz LPDDR3 <br />

Oracle VirtualBox Version 7.1.4 r165100 (Qt6.5.3) <br />
Debian GNU/Linux 12 Bookworm (64-bit) <br />
4000 MB RAM <br />
60 GB Levytilaa <br />

## x) Lue ja tiivistä

### Two Machine Virtual Network With Debian 11 Bullseye and Vagrant (Karvinen, T. 2021)

### Karvinen 2018: Salt Quickstart – Salt Stack Master and Slave on Ubuntu Linux (Huomaa: Nykyisin ennen Saltin asentamista on asennettava ensin varasto [package repository], ohje h1 vinkeissä)

### Karvinen 2014: Hello Salt Infra-as-Code (Huomaa: kannattaa laittaa jokainen moduli omaan kansioonsa toisin kuin artikkelissani. Hyvä: "/srv/salt/hello/init.sls" eli moduli "hello" siististi omana kansionaan. Huono: "/srv/salt/hups.sls" eli sls-tiedostot ja kaikki niihin liittyvät muotit hujan hajan saltin pääkansiossa)

### Karvinen 2023: Salt Vagrant - automatically provision one master and two slaves, vain kohdat
Infra as Code - Your wishes as a text file
top.sls - What Slave Runs What States

### Salt contributors: Salt overview, kohdat
Rules of YAML
YAML simple structure
Lists and dictionaries - YAML block structures

## a) Hello Vagrant! Osoita jollain komennolla, että Vagrant on asennettu (esim tulostaa vagrantin versionumeron). Jos et ole vielä asentanut niitä, raportoi myös Vagrant ja VirtualBox asennukset. (Jos Vagrant ja VirtualBox on jo asennettu, niiden asennusta ei tarvitse tehdä eikä raportoida uudelleen.)

## b) Linux Vagrant. Tee Vagrantilla uusi Linux-virtuaalikone.

## c) Kaksin kaunihimpi. Tee kahden Linux-tietokoneen verkko Vagrantilla. Osoita, että koneet voivat pingata toisiaan.

## d) Herra-orja verkossa. Demonstroi Salt herra-orja arkkitehtuurin toimintaa kahden Linux-koneen verkossa, jonka teit Vagrantilla. Asenna toiselle koneelle salt-master, toiselle salt-minion. Laita orjan /etc/salt/minion -tiedostoon masterin osoite. Hyväksy avain ja osoita, että herra voi komentaa orjakonetta.

## e) Hei infrakoodi! Kokeile paikallisesti (esim 'sudo salt-call --local') infraa koodina. Kirjota sls-tiedosto, joka tekee esimerkkitiedoston /tmp/ -kansioon.

## f) Aja esimerkki sls-tiedostosi verkon yli orjalla.

## g) Tee sls-tiedosto, joka käyttää vähintään kahta eri tilafunktiota näistä: package, file, service, user. Tarkista eri ohjelmalla, että lopputulos on oikea. Osoita useammalla ajolla, että sls-tiedostosi on idempotentti.

## h) Top file. Automatisoi vähintään kahden tilan / modulin ajaminen. Esim. komento 'sudo salt "*" state.apply' tai 'sudo salt-call --local state.apply' ajaa modulit "hello" ja "apache".

## i) Vapaaehtoinen, haastavahko tässä vaiheessa: Asenna ja konfiguroi Apache. Sen tulee näyttää palvelimen etusivulla weppisivua. Weppisivun tulee olla muokattavissa käyttäjän oikeuksin, ilman sudoa.


### Lähteet

- Karvinen, T. 2023. Salt Vagrant - automatically provision one master and two slaves. Luettavissa: https://terokarvinen.com/2023/salt-vagrant/#infra-as-code---your-wishes-as-a-text-file. Viitattu: xx.xx.xxxx.
- Karvinen, T. 2021. Two Machine Virtual Network With Debian 11 Bullseye and Vagrant. Luettavissa: https://terokarvinen.com/2021/two-machine-virtual-network-with-debian-11-bullseye-and-vagrant/. Viitattu: xx.xx.xxxx.
- Karvinen, T. 2018. Salt Quickstart – Salt Stack Master and Slave on Ubuntu Linux. Luettavissa: https://terokarvinen.com/2018/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/?fromSearch=salt%20quickstart%20salt%20stack%20master%20and%20slave%20on%20ubuntu%20linux. Viitattu: xx.xx.xxxx.
- Karvinen, T. 2014. Hello Salt Infra-as-Code. Luettavissa: https://terokarvinen.com/2024/hello-salt-infra-as-code/. Viitattu: xx.xx.xxxx.
- Salt contributors 2021-2024. Salt overview. Luettavissa: https://docs.saltproject.io/salt/user-guide/en/latest/topics/overview.html#rules-of-yaml. Viitattu: xx.xx.xxxx.


