# H1

## x) Lue ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva. Ei siis vaadita pitkää eikä essee-muotoista tiivistelmää.)
Karvinen 2023: Run Salt Command Locally
Karvinen 2018: Salt Quickstart – Salt Stack Master and Slave on Ubuntu Linux
Karvinen 2006: Raportin kirjoittaminen
Saltin asennus edellyttää nykyään (Debian 12 Bookworm) uuden pakettivaraston asentamista, mitä ei käsitellä näissä artikkelissa. Ohjeet pakettivaraston asentamiseen vinkeissä alla.

## a) Debian 12-Bookwormin asennuksessa virtuaalikoneeseen ei ongelmia.

## b) Asenna Salt (salt-minion) Linuxille (uuteen virtuaalikoneeseesi).

    $ sudo apt-get update
    $ sudo apt-get -y install salt-minion

Tästä antaa errorin:

Yritän selvitellä tätä monelta eri sivustolta ja löydän mahdollisen vastauksen (Salt install guide).

Annoin komennot:

    $ mkdir /etc/apt/keyrings

    $ sudo curl -fsSL -o /etc/apt/keyrings/salt-archive-keyring-2023.gpg https://repo.saltproject.io/salt/py3/debian/12/amd64/SALT-PROJECT-GPG-PUBKEY-2023.gpg
    
    $ echo "deb [signed-by=/etc/apt/keyrings/salt-archive-keyring-2023.gpg arch=amd64] https://repo.saltproject.io/salt/py3/debian/12/amd64/3007 bookworm main" | sudo tee /etc/apt/sources.list.d/salt.list

Näillä komennoilla oli tarkoitus valmistaa järjestelmää asentamaan Salt Projectin ohjelmistoja, varmistavat pakettien aitoutta ja lisäämään tarvittavan ohjelmistolähteen APT-lähdeluetteloon (Salt install guide).

Seuraavaksi annoin toistamiseen komennot:

    $ sudo apt-get update
    $ sudo apt-get -y install salt-minion

Onnistui!

Sitten vielä version tsekkaus komennolla: 

    $ sudo salt-call --version    

## c) Viisi tärkeintä. Näytä Linuxissa esimerkit viidestä tärkeimmästä Saltin tilafunktiosta: pkg, file, service, user, cmd. Analysoi ja selitä tulokset.

### pkg

Annan komennon, jolla tarkoistetaan, onko "tree"- ohjelmisto asennettuna järjestelmässä, ja mikäli ei ole, se asentaa sen:

      $ sudo salt-call --local -l info state.single pkg.installed tree

Näyttää tältä: 

Lyhyesti lokitieodostosta näkyy, että ohjelmistoa ei ollut, mutta nyt on asennettuna. Ohjelmisto löytyy nimellä "tree", asennus onnistui ja siinä meni yhteensä n. 9,37 sekuntia. Lokitiedoista näkyy ainoastaan uusi versio, koska vanhaa ei ollut. Mitään virheitä ei esiintynyt. 

Kun annan komennon 

    $ sudo salt-call --local -l info state.single pkg.removed tree

Lokitiedot näyttää tältä: 

Näistä näemme, että koko ohjelmisto "tree" poistettin onnistuneesti, ja siihen meni yhteensä n. 7,17 sekuntia. Vanhaksi versioksi on ilmoitettu 2.1.0-1 ja uudeksi tyhjä, koska sitä ei enää ole. Poisto onnistui. 

### file

Annan komennon: 

    $ sudo salt-call --local -l info state.single file.managed /tmp/hellohanna

Lokitiedot näyttävät tältä: 

Tällä komennolla on siis luotu onnistuneesti tyhjä tiedosto polkuun /tmp/hellohanna. 

Komennolla:

    $ sudo salt-call --local -l info state.single file.managed /tmp/moihanna contents="hellurei"

Lokitiedot näyttää tältä:

Tällä komennolla loin tiedoston polkuun /tmp/moihanna ja tiedostoon on kirjoitettu sana hellurei. 

Tällä komennolla poistetaan koko /tmp/hellohanna tiedosto: 

    $ sudo salt-call --local -l info state.single file.absent /tmp/hellohanna

Tässä vielä lokitiedot siitä:

Lokitiedoista näkyy, että apache2 on käynnissä, eikä sitä tarvinnut käynnistää uudelleen.

Tällä komennolla pysäytetään apache ja varmistetaan, ettei se käynnisty automaattisesti, kun järjestelmä seuraavan kerran käynnistyy:

    $ sudo salt-call --local -l info state.single service.dead apache2 enable=False

Tässä siitä vielä lokitiedot: 

### service

Seuraavalla komennolla varmistetaan, että määritetty palvelu on käynnissä. Tämä funktio voi myös automaattisesti käynnistää palvelun uudelleen, jos sen asetuksia muutetaan:

    $ sudo salt-call --local -l info state.single service.running apache2 enable=True

Tässä siitä lokitiedosto:

### user

Tämä komento varmistaa, että määritetty käyttäjä on olemassa järjestelmässä. Jos käyttäjää ei ole, tämä komento luo sen:

    $ sudo salt-call --local -l info state.single user.present hannis24

Lokitiedot tästä:

Tämä komento varmistaa, että määritetty käyttäjä ei ole olemassa järjestelmässä. Jos käyttäjä on olemassa, tämä komento poistaa sen:

    $ sudo salt-call --local -l info state.single user.absent hannis24

Lokitiedot tästä: 


### cmd

Seuraavalla komennolla olisi tarkoitus luoda /tmp/hellurei tiedosto JOS sitä ei ole jo olemassa. Jos se on jo olemassa, mitään ei tapahdu. Tällä vältetään turhat muutokset ja virheet.  

    $ sudo salt-call --local -l info state.single cmd.run 'touch /tmp/hellurei' creates="/tmp/hellurei"

Lokitiedot tästä: 





## d) Idempotentti. Anna esimerkki idempotenssista. Aja 'salt-call --local' komentoja, analysoi tulokset, selitä miten idempotenssi ilmenee.

    $ sudo salt-call --local sys.state_doc

    
## e) Herra-orja. Kokeile herra-orja arkkitehtuuria niin, että herra ja orja ovat samalla koneella.

### LÄHTEET

- Salt Install Guide. Luettavissa: https://docs.saltproject.io/salt/install-guide/en/latest/topics/install-by-operating-system/debian.html#install-salt-on-debian-12-bookworm-arm64. Viitattu: 27.10.2024



